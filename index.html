<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gamepad Display Demo</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    #container {
      background: #2a2a2a;
      padding: 30px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .layouts {
      --scale: calc(300 / 225);
      display: flex;
      flex-direction: column;
      gap: 30px;
      align-items: center;
      width: 100%;
    }
    .layout-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .layout-section h3 {
      margin: 0;
      font-size: 14px;
      color: #888;
    }
    #gamepad-default svg {
      width: calc(225px * var(--scale));
      height: auto;
    }
    #gamepad-horizontal svg {
      width: calc(333px * var(--scale));
      height: auto;
    }
    h1 {
      margin: 0 0 10px 0;
    }
    .info {
      color: #888;
      font-size: 14px;
    }
    .connected {
      color: #22c55e;
    }
    .controls {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px 20px;
      width: 100%;
      max-width: 400px;
      align-items: center;
    }
    .controls label {
      font-size: 14px;
      color: #aaa;
    }
    .controls input[type="color"] {
      width: 100%;
      height: 36px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .controls select {
      width: 100%;
      height: 36px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #3a3a3a;
      color: #fff;
      padding: 0 10px;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Gamepad Display</h1>
    <p class="info">Connect a gamepad and press any button</p>
    <p id="status" class="info"></p>

    <div class="layouts">
      <div class="layout-section">
        <h3>Default</h3>
        <div id="gamepad-default"></div>
      </div>
      <div class="layout-section">
        <h3>Horizontal</h3>
        <div id="gamepad-horizontal"></div>
      </div>
    </div>

    <div class="controls">
      <label for="primary-color">Primary Color:</label>
      <input type="color" id="primary-color" value="#0d6efd">

      <label for="outline-color">Button Outline:</label>
      <input type="color" id="outline-color" value="#6c757d">

      <label for="stick-color">Stick Base:</label>
      <input type="color" id="stick-color" value="#dee2e6">

      <label for="label-color">Button Labels:</label>
      <input type="color" id="label-color" value="#6c757d">
    </div>
  </div>

  <script type="module">
    import { GamepadDisplay } from './src/index.ts';

    const status = document.getElementById('status');
    const displays = [
      new GamepadDisplay(document.getElementById('gamepad-default'), { layout: 'default' }),
      new GamepadDisplay(document.getElementById('gamepad-horizontal'), { layout: 'horizontal' })
    ];

    const primaryColorInput = document.getElementById('primary-color');
    const outlineColorInput = document.getElementById('outline-color');
    const stickColorInput = document.getElementById('stick-color');
    const labelColorInput = document.getElementById('label-color');

    primaryColorInput.addEventListener('input', (e) => {
      displays.forEach(d => d.setColors({ primary: e.target.value }));
    });

    outlineColorInput.addEventListener('input', (e) => {
      displays.forEach(d => d.setColors({ buttonOutline: e.target.value }));
    });

    stickColorInput.addEventListener('input', (e) => {
      displays.forEach(d => d.setColors({ stickBase: e.target.value }));
    });

    labelColorInput.addEventListener('input', (e) => {
      displays.forEach(d => d.setColors({ buttonLabel: e.target.value }));
    });

    let gamepadIndex = null;

    window.addEventListener('gamepadconnected', (e) => {
      gamepadIndex = e.gamepad.index;
      status.textContent = `Connected: ${e.gamepad.id}`;
      status.className = 'info connected';
    });

    window.addEventListener('gamepaddisconnected', () => {
      gamepadIndex = null;
      status.textContent = 'Gamepad disconnected';
      status.className = 'info';
    });

    function updateGamepad() {
      if (gamepadIndex !== null) {
        const gamepads = navigator.getGamepads();
        const gamepad = gamepads[gamepadIndex];

        if (gamepad) {
          const axes = Array.from(gamepad.axes);
          const buttons = gamepad.buttons.map(b => b.value);
          displays.forEach(d => d.update(axes, buttons));
        }
      }
      requestAnimationFrame(updateGamepad);
    }

    updateGamepad();
  </script>
</body>
</html>
